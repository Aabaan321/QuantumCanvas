<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NebulaTouch v5: Crystal Expanse</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@300;400;600&display=swap');
        *{margin:0;padding:0;box-sizing:border-box}
        body{margin:0;overflow:hidden;background:#020208;font-family:'Inter','Orbitron',sans-serif;color:#fff}
        canvas{display:block;position:absolute;top:0;left:0}
        #video-input{position:absolute;top:0;left:0;opacity:0;pointer-events:none}

        .hand-cursor{position:absolute;width:50px;height:50px;border-radius:50%;transform:translate(-50%,-50%);pointer-events:none;opacity:0;transition:opacity .3s}
        .hand-cursor.visible{opacity:1}
        .hand-cursor .ring{position:absolute;inset:0;border-radius:50%;border:2px solid var(--clr,#00ffe5);animation:hcPulse 1.5s ease-in-out infinite}
        .hand-cursor .dot{position:absolute;top:50%;left:50%;width:8px;height:8px;background:var(--clr,#00ffe5);border-radius:50%;transform:translate(-50%,-50%);box-shadow:0 0 12px var(--clr,#00ffe5)}
        @keyframes hcPulse{0%,100%{transform:scale(1);opacity:.8}50%{transform:scale(1.4);opacity:.3}}

        #ui{position:absolute;top:16px;left:16px;width:300px;z-index:10;background:linear-gradient(135deg,rgba(6,10,28,.92),rgba(4,6,18,.88));padding:16px;border-radius:16px;border:1px solid rgba(0,255,229,.15);box-shadow:0 8px 40px rgba(0,255,229,.08),inset 0 1px 0 rgba(255,255,255,.04);backdrop-filter:blur(24px);max-height:88vh;overflow-y:auto;transition:all .4s cubic-bezier(.4,0,.2,1)}
        #ui.minimized{max-height:52px;overflow:hidden}
        #ui::-webkit-scrollbar{width:4px}
        #ui::-webkit-scrollbar-thumb{background:linear-gradient(180deg,#00ffe5,#7b61ff);border-radius:4px}

        .logo{display:flex;align-items:center;gap:8px;cursor:pointer;user-select:none;margin-bottom:12px}
        .logo-icon{font-size:1.4rem}
        .logo h1{font-family:'Orbitron',monospace;font-size:.95rem;font-weight:900;letter-spacing:2px;background:linear-gradient(135deg,#00ffe5,#7b61ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .logo .ver{font-size:.55rem;color:rgba(255,255,255,.35);font-weight:400;letter-spacing:1px}

        .stats{display:grid;grid-template-columns:repeat(4,1fr);gap:6px;margin-bottom:10px}
        .stat{background:rgba(255,255,255,.03);padding:6px;border-radius:8px;text-align:center;border:1px solid rgba(255,255,255,.04)}
        .stat .label{font-size:.55rem;color:rgba(255,255,255,.4);text-transform:uppercase;letter-spacing:.5px;margin-bottom:2px}
        .stat .val{font-family:'Orbitron',monospace;font-size:.75rem;font-weight:700;color:#00ffe5}

        .detect-bar{padding:8px 12px;border-radius:8px;text-align:center;font-size:.7rem;font-weight:600;margin-bottom:10px;transition:all .3s;border:1px solid}
        .detect-bar.none{background:rgba(255,60,60,.08);border-color:rgba(255,60,60,.25);color:#ff6b6b}
        .detect-bar.ok{background:rgba(0,255,180,.08);border-color:rgba(0,255,180,.2);color:#00ffb4}

        .gesture-live{padding:8px 12px;border-radius:8px;background:rgba(123,97,255,.08);border:1px solid rgba(123,97,255,.2);text-align:center;font-size:.7rem;color:#b8a5ff;margin-bottom:10px;min-height:30px;display:flex;align-items:center;justify-content:center;gap:6px}
        .gesture-live .g-emoji{font-size:1.2rem}

        .section{margin-bottom:8px;border-radius:10px;overflow:hidden;background:rgba(255,255,255,.015);border:1px solid rgba(255,255,255,.03)}
        .sec-hdr{padding:8px 12px;cursor:pointer;user-select:none;display:flex;justify-content:space-between;align-items:center;font-size:.75rem;font-weight:600;color:rgba(255,255,255,.7);transition:all .2s}
        .sec-hdr:hover{background:rgba(255,255,255,.03);color:#fff}
        .sec-hdr .arrow{transition:transform .3s;font-size:.6rem;color:rgba(255,255,255,.3)}
        .section.closed .arrow{transform:rotate(-90deg)}
        .sec-body{padding:8px 10px;max-height:400px;overflow:hidden;transition:max-height .4s cubic-bezier(.4,0,.2,1),padding .3s}
        .section.closed .sec-body{max-height:0;padding:0 10px}

        .g-row{display:flex;justify-content:space-between;padding:4px 6px;margin:2px 0;border-radius:4px;font-size:.65rem}
        .g-row:hover{background:rgba(255,255,255,.03)}
        .g-name{color:#00ffe5}
        .g-desc{color:rgba(255,255,255,.35)}
        .g-key{display:inline-block;background:rgba(123,97,255,.15);padding:1px 5px;border-radius:3px;font-size:.6rem;font-weight:700;color:#b8a5ff;margin-left:4px}

        .tip{font-size:.6rem;color:rgba(255,255,255,.3);padding:8px;background:rgba(255,255,255,.015);border-radius:6px;margin-top:6px;line-height:1.4}

        #fx-panel{position:absolute;top:16px;right:16px;width:240px;background:linear-gradient(135deg,rgba(18,6,30,.92),rgba(10,4,20,.88));padding:14px;border-radius:16px;border:1px solid rgba(123,97,255,.15);backdrop-filter:blur(24px);box-shadow:0 8px 40px rgba(123,97,255,.08);z-index:10;transition:all .4s}
        #fx-panel.minimized{max-height:48px;overflow:hidden}
        #fx-panel .panel-title{font-family:'Orbitron',monospace;font-size:.8rem;font-weight:900;color:#b8a5ff;cursor:pointer;user-select:none;margin-bottom:10px;display:flex;align-items:center;gap:6px}
        .fx-grid{display:grid;gap:4px}
        .fx-item{font-size:.68rem;padding:6px 10px;border-radius:6px;display:flex;justify-content:space-between;align-items:center;border-left:3px solid transparent;transition:all .25s;background:rgba(255,255,255,.015)}
        .fx-item.on{color:#00ffb4;font-weight:600;background:rgba(0,255,180,.06);border-left-color:#00ffb4}
        .fx-item.off{color:rgba(255,255,255,.25)}
        .fx-item .dot{width:6px;height:6px;border-radius:50%;background:currentColor}

        #mode-label{position:absolute;bottom:50px;left:50%;transform:translateX(-50%);font-family:'Orbitron',monospace;font-size:1.6rem;font-weight:900;background:linear-gradient(135deg,#00ffe5,#7b61ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;pointer-events:none;filter:drop-shadow(0 0 30px rgba(0,255,229,.3));letter-spacing:4px;transition:all .4s}

        #gesture-fb{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%) scale(.6);font-size:5rem;opacity:0;pointer-events:none;transition:all .5s cubic-bezier(.34,1.56,.64,1);filter:drop-shadow(0 0 30px rgba(255,255,255,.3))}
        #gesture-fb.show{opacity:1;transform:translate(-50%,-50%) scale(1)}

        .ctrl-bar{position:absolute;bottom:20px;left:20px;display:flex;gap:8px;z-index:20}
        .ctrl-btn{background:linear-gradient(135deg,#7b61ff,#5a3fd6);color:#fff;border:none;padding:10px 18px;border-radius:10px;cursor:pointer;font-family:'Orbitron',monospace;font-weight:700;font-size:.7rem;box-shadow:0 4px 20px rgba(123,97,255,.3);transition:all .3s;letter-spacing:1px}
        .ctrl-btn:hover{transform:translateY(-2px);box-shadow:0 8px 30px rgba(123,97,255,.5)}

        .mouse-hint{position:absolute;bottom:20px;right:20px;font-size:.6rem;color:rgba(255,255,255,.2);z-index:10;text-align:right;line-height:1.6;pointer-events:none}
    </style>
</head>
<body>
    <div class="hand-cursor" id="hc1" style="--clr:#00ffe5"><div class="ring"></div><div class="dot"></div></div>
    <div class="hand-cursor" id="hc2" style="--clr:#b8a5ff"><div class="ring"></div><div class="dot"></div></div>

    <div id="ui">
        <div class="logo" onclick="toggleUI()">
            <span class="logo-icon">‚ú¶</span>
            <div><h1>NEBULATOUCH</h1><div class="ver">v5 ¬∑ CRYSTAL EXPANSE</div></div>
        </div>

        <div id="detect-bar" class="detect-bar none">Initializing‚Ä¶</div>

        <div class="stats">
            <div class="stat"><div class="label">Shape</div><div class="val" id="s-shape">SPHERE</div></div>
            <div class="stat"><div class="label">Hands</div><div class="val" id="s-hands">0</div></div>
            <div class="stat"><div class="label">Zoom</div><div class="val" id="s-zoom">100%</div></div>
            <div class="stat"><div class="label">FPS</div><div class="val" id="s-fps">60</div></div>
        </div>

        <div class="gesture-live" id="gesture-live"><span style="opacity:.5">Awaiting gesture‚Ä¶</span></div>

        <div class="section" id="sec-gestures">
            <div class="sec-hdr" onclick="togSec('sec-gestures')"><span>üñêÔ∏è Gestures (20)</span><span class="arrow">‚ñæ</span></div>
            <div class="sec-body">
                <div class="g-row"><span class="g-name">üëã Swipe</span><span class="g-desc">Change Shape</span></div>
                <div class="g-row"><span class="g-name">ü§è Pinch</span><span class="g-desc">Resize</span></div>
                <div class="g-row"><span class="g-name">‚úã Move</span><span class="g-desc">Rotate</span></div>
                <div class="g-row"><span class="g-name">‚úåÔ∏è Peace</span><span class="g-desc">Auto-Rotate</span></div>
                <div class="g-row"><span class="g-name">üëç Thumbs Up</span><span class="g-desc">Colors</span></div>
                <div class="g-row"><span class="g-name">üëé Thumbs Down</span><span class="g-desc">Reset</span></div>
                <div class="g-row"><span class="g-name">‚òùÔ∏è Point Up</span><span class="g-desc">Speed+</span></div>
                <div class="g-row"><span class="g-name">üëá Point Down</span><span class="g-desc">Speed‚àí</span></div>
                <div class="g-row"><span class="g-name">ü§ò Rock</span><span class="g-desc">Explode</span></div>
                <div class="g-row"><span class="g-name">üññ Vulcan</span><span class="g-desc">Freeze</span></div>
                <div class="g-row"><span class="g-name">ü§ô Hang Loose</span><span class="g-desc">Wave</span></div>
                <div class="g-row"><span class="g-name">üëå OK</span><span class="g-desc">Vortex</span></div>
                <div class="g-row"><span class="g-name">‚úä Fist</span><span class="g-desc">Compress</span></div>
                <div class="g-row"><span class="g-name">üñêÔ∏è Open</span><span class="g-desc">Expand</span></div>
                <div class="g-row"><span class="g-name">ü§≤ Both Open</span><span class="g-desc">Gravity</span></div>
                <div class="g-row"><span class="g-name">‚úåÔ∏è‚úåÔ∏è Both Peace</span><span class="g-desc">Mirror</span></div>
                <div class="g-row"><span class="g-name">üëê Push Apart</span><span class="g-desc">Expand</span></div>
                <div class="g-row"><span class="g-name">ü§úü§õ Pull</span><span class="g-desc">Contract</span></div>
                <div class="g-row"><span class="g-name">üëè Clap</span><span class="g-desc">Shockwave</span></div>
                <div class="g-row"><span class="g-name">ü§èü§è Zoom</span><span class="g-desc">Camera Zoom</span></div>
            </div>
        </div>

        <div class="section" id="sec-keys">
            <div class="sec-hdr" onclick="togSec('sec-keys')"><span>‚å®Ô∏è Keys</span><span class="arrow">‚ñæ</span></div>
            <div class="sec-body">
                <div class="g-row"><span class="g-name">T</span><span class="g-desc">Trails</span></div>
                <div class="g-row"><span class="g-name">S</span><span class="g-desc">Sound</span></div>
                <div class="g-row"><span class="g-name">R</span><span class="g-desc">Rainbow</span></div>
                <div class="g-row"><span class="g-name">P</span><span class="g-desc">Pulsate</span></div>
                <div class="g-row"><span class="g-name">C</span><span class="g-desc">Screenshot</span></div>
                <div class="g-row"><span class="g-name">W</span><span class="g-desc">Warp Speed</span></div>
                <div class="g-row"><span class="g-name">N</span><span class="g-desc">Next Shape</span></div>
                <div class="g-row"><span class="g-name">B</span><span class="g-desc">Prev Shape</span></div>
                <div class="g-row"><span class="g-name">Space</span><span class="g-desc">Explode</span></div>
            </div>
        </div>
        <div class="tip">üí° Use mouse to rotate (drag) and zoom (scroll). Hand tracking needs webcam + good lighting.</div>
    </div>

    <div id="fx-panel">
        <div class="panel-title" onclick="togFx()">‚ú¶ EFFECTS</div>
        <div class="fx-grid" id="fx-grid"></div>
    </div>

    <div class="ctrl-bar">
        <button class="ctrl-btn" onclick="resetAll()">RESET</button>
        <button class="ctrl-btn" onclick="takeScreenshot()">üì∏ CAPTURE</button>
    </div>

    <div id="mode-label">SPHERE</div>
    <div id="gesture-fb"></div>
    <div class="mouse-hint">üñ± Drag to rotate ¬∑ Scroll to zoom</div>
    <video id="video-input" playsinline></video>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
    <script src="app.js"></script>
</body>
</html>
